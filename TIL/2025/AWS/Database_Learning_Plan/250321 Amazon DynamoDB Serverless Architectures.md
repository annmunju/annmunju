- NoSQL 데이터베이스
	- (CPU보다) 저렴한 스토리지를 이용해 정의된 질문 세트로 적시 대답하도록 모두 저장하는 방식. CPU 의존하지 않으며 데이터 구조와 더 많은 유연성이 있음. 
	- 질문에 대한 답변은 지정되어 있으며 API로 결과를 검색한다.
- 가용성, 내구성 및 확장성 제공 및 서버 관리 필요 없음
- 모니터링 및 보안 지표 제공. AWS 전세계 리전에서 사용할 수 있음
- OLTP를 위한 설계에 사용. 라이브 작업, 대화형 애플리케이션, 작은 객체 등에 적합
	- 일관된 짧은 지연시간
![[Pasted image 20250321144300.png]]
## 작동 방식
- 테이블 / 항목 / 속성으로 구성됨
- 속성 - 파티션 키 필수 / 정렬 키 선택 (두 키는 기본 키로 구성됨. 이는 고유해야함)
- 스키마 유연성
- 관계형 데이터베이스 - 샤딩 기술 사용 (데이터 집합이 여러 서버 혹은 클러스터로 분할) -> DynamoDB에서도 이와같은 기술 사용(관리형). 일반적으로는 볼륨을 광범위하게 배포하거나 기본키에 걸쳐 요청 속도를 높이기 위해 테이블 파티셔닝 사용

- 중첩 속성과 리스트를 사용할 수 있음
- 리전 내 장애 독립적 영역에 인프라 전체 항목의 여러 복사본을 유지 관리함
- 쓰기 후 읽기 일관성. 최종 일관성 제공. 잠금 메커니즘 아님. 최종적 일관적 읽기 전략
	- 테이블 처리량 지정. 읽기 용량 단위 / 쓰기 용량 단위. 파티션 간 처리량 균등하게 분할
- 비용 부과
	- 버스트 기능 (이월 시간)
	- 적응형 용량 (지능형 보상) 덜 활성화된 키에 처리량을 빌림 (불균형 일부 허용)
	- 단일 항목은 3000 RCU 초과, 1000 WCU 초과 혹은 둘의 선형 조합으로 사용
- 기본 항목 요청
	- 쓰기 요청: PutItem / UpdateItem / BatchWriteItem / deleteItem
	- 읽기 요청 : GetItem / BatchGetItem / Query / Scan
	- 일부 요청도 가능하나 처리량은 전체 반환과 동일
- 다른 기본키 관점에서 테이블 읽어올 때 처리량 줄이는 방법 - 보조 인덱스
	- 기본 인덱스 대신 Query, Scan 가능. 이런 속성을 추가할 수 있음
	- 로컬 / 글로벌 보조 인덱스

|특성|로컬 보조 인덱스 (LSI)|글로벌 보조 인덱스 (GSI)|
|---|---|---|
|키 구조|테이블과 동일한 파티션 키, 다른 정렬 키|테이블과 다른 파티션 키와 정렬 키(선택적)|
|쿼리 범위|동일한 파티션 키 내에서만 쿼리 가능|전체 테이블에 걸쳐 쿼리 가능|
|생성 및 관리|테이블 생성 시에만 생성 가능, 이후 수정/삭제 불가|테이블 생성 시 또는 이후에도 생성/수정/삭제 가능|
|일관성|강력한 일관성과 최종 일관성 모두 지원|최종 일관성만 지원|
|처리량|기본 테이블의 처리량 사용|자체적인 처리량 설정|
|크기 제한|파티션 키당 10GB 제한|크기 제한 없음|
|프로젝션|프로젝션되지 않은 속성도 쿼리 결과에 포함 가능|프로젝션된 속성만 쿼리 결과에 포함|
* 일관성 개념

| 특성                        | 강력한 일관성 / 강력하게 일관된 읽기  | 최종 일관성 / 최종적으로 일관된 읽기           |
| ------------------------- | ---------------------- | ------------------------------- |
| 데이터 일관성                   | 항상 최신 데이터 반환           | 일시적으로 오래된 데이터 반환 가능             |
| 지연 시간                     | 상대적으로 높음               | 상대적으로 낮음                        |
| 비용                        | 더 높음 (2배)              | 더 낮음                            |
| 가용성(시스템이 장애 없이 사용 가능한 상태) | 상대적으로 낮음               | 상대적으로 높음                        |
| 지원 범위                     | 테이블, 로컬 보조 인덱스         | 테이블, 로컬 보조 인덱스, 글로벌 보조 인덱스, 스트림 |
| 사용 사례                     | 금융 거래 등 즉시 정확성이 필요한 경우 | 약간의 지연이 허용되는 일반적인 경우            |


- 스트림: 데이터베이스의 변경 사항을 실시간으로 추적
	1. **변경 사항 기록**: 누군가 데이터베이스에 새로운 정보를 추가하거나, 기존 정보를 수정하거나, 삭제할 때마다 이 변경 사항이 스트림에 기록됩니다.
	2. **시간 순서**: 모든 변경 사항은 발생한 순서대로 정확하게 기록됩니다.
	3. **유지 기간**: 이 기록은 24시간 동안 보관됩니다. 그 후에는 자동으로 삭제됩니다.
	4. **세부 정보 선택**: 스트림을 설정할 때, 얼마나 자세한 정보를 기록할지 선택할 수 있습니다. 예를 들어, 변경된 항목의 이전 상태와 새로운 상태를 모두 기록할 수도 있고, 단순히 변경이 있었다는 사실만 기록할 수도 있습니다.
	- 활용 : 실시간 모니터링, 백업, 분석

## 운영
- 클라이언트 구성 및 오류 복원력 구성
	- 400 오류는 사용자 해결
	- 500 오류는 AWS 해결
- 재시도 로직 설정 가능. (횟수 제한, 시간 제한 등)
- 배치 작업의 오류처리
	- BatchGetItem - BatchWriteItem을 래퍼라고 생각하고 사용
	- 처리되지 않은 항목에 대해 반환된 정보를 사용해 고유의 재시도 논리를 생성. 애플리케이션 단에서 백오프 구현 필요
- 오토 스케일링
	- 프로비저닝된 처리량을 동적 조정
	- CloudWatch 지표를 모니터링하고 UpdateTable 호출을 수행하는 방식
	- RCU, WCU를 별도로 관리하고 최소, 최대 및 대상 사용률을 설정
	- 즉각적 대응은 어려움. 목표 사용률 설정이 사용 기록을 살펴보고 적절한 버퍼를 생성해야함.
- 글로벌 테이블
	- 마지막 쓰기 우선 전용으로 충돌 해결
	- 리전 간의 강력한 일관성은 불가능함
	- 강력하게 일관된 읽기 후 쓰기를 원할 경우 동일 리전에서 읽도록 클라이언트에 지시해야함
	- 리전 재해 발생시 워밍 장애 조치 대상 리전 설정. 다른 지역에 지리적 라우팅을 사용해 글로벌 클라이언트를 가장 가까운 글로벌 엔드포인트로 가져올 수 있음
- TTL을 사용한 항목 완료
	- 타임스탬프 항목 속성은 삭제할 수 있는 시기를 나타냄. TTL로 트리거된 삭제는 프로비저닝된 용량(WCU)을 소비하지 않음. 해당 속성이 만료되면 삭제됨 -> Lambda 연결해서 삭제시 S3로 이전해둘 수 있음.
- 보안
	- 엑세스 제어 IAM
	- VPC 격리 사용 VPC 엔드포인트 
- DAX (dynamoDB Accelerator)
	- 동시 기록 캐시
	- 캐시를 통해 기록된 항목 및 업데이트는 최종 일관성 있는 읽기를 생성할 때 자동 사용
	- 강력하게 일관된 읽기는 캐시되지 않음
	- RCU 양을 줄이고 불균형 부하를 평준화할 수 있음. 1자릿수 밀리초 응답 시간을 소수점 이하로 단축
- 백업 및 복원
	- 필요할때 백업 수행 = 온디멘드
	- 특정 시점으로 복구 = PITR : 35일 이내 어느 시점이든 초단위 복구 가능
	- 선택 항목만 복구 가능. 10시간 이내에 완료됨. 분할된 데이터는 병렬로 복구됨.
- 모니터링 및 문제 해결
	- 애플리케이션에 로그를 추가해서 확인
	- CloudTrail을 사용해 DynamoDB 제어 API 호출을 로깅

## 설계 고려 사항
1. 균일한 워크로드 : 파티션 키를 잘 선택하기. 고유한 값이 많이 있어야함.
	- 쓰기의 경우 평준화를 위해서 대기열을 깔아놓기도 함
2. 핫 및 콜드 데이터 : 자주 사용하는 데이터와 그렇지 않은 데이터를 분리
3. 큰 속성 : 한 항목당 400KB 까지만. 큰 파일은 다른곳에 저장. 대용량 객체를 사용하는 경우 객체를 더 작은 청크로 나누고 별도 항목으로 유지하기. 
4. 인덱스: LSI와 GSI를 필요한 만큼 사용하기
5. 버전 번호를 이용하는 낙관적 잠금: 여러 사람이 동시에 같은 데이터를 수정하려고 할 때, 버전 번호를 사용해 충돌을 방지할 것
6. 일대다 테이블: 집합 유형의 속성에 다수 값을 저장하는 항목이 테이블에 있으면 다른 테이블로 분할하는 것을 고려.
7. 다양한 액세스 패턴: 자주 액세스하는 속성을 별도 테이블에 저장하는 것을 고려.
8. 데이터베이스 마이그레이션
	- 새 DynamoDB 테이블 만들고 
	- 기존 데이터 옮기고
	- 애플리케이션 수정해서 DynamoDB 사용하도록 함
	- 관련 서비스 : DMS

## 서버리스 아키텍처 패턴
![[Pasted image 20250321172346.png]]
- dynamodb 스트림을 lambda와 함께 사용해 다른 서비스로 공급하는 방법
	- 쓰기 작업이 트리거가 되어서 변경사항을 기준으로 필터링하고 lambda 작업 수행

### 시계열 데이터 예
- 수천개 센서로 기온 판독값 수집 및 저장

1. 키네시스 배치로 센서 판독값 구현
![[Pasted image 20250321172525.png]]

2. 솔루션 아키텍처
![[Pasted image 20250321172557.png]]

3. 개정된 솔루션
![[Pasted image 20250321172707.png]]
- 여러 데이터 포인트를 단일 항목으로 그룹화하여 WCU를 절약
- Lambda 배치 크기를 사용하여 하나의 목록 속성으로 데이터 요소를 배치