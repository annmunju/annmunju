## 소개
- 자동으로 확장되는 내결함성을 갖춘 자가 복구 분산 저장 시스템
- 지연 시간이 짧은 읽기 전용 복제본 최대 15개, 특정 시점으로 복구, Amazon Simple Storage Service(Amazon S3)로 지속적 백업, 3개의 가용 영역에 걸친 복제를 통해 뛰어난 성능과 가용성 제공
- Aurora는 데이터 복사본 6개를 만들어 여러 위치에 분산하고 Amazon S3에 지속적으로 백업하여 데이터를 안전하게 보호
- 이점
	- 관리 비용 감소
	- 유연성 향상
	- 성능 향상
	- 데이터 보증
	- 고가용성
	- 스마트한 데이터
- 보안
	- **AWS CloudHSM** : 하드웨어 보안 모듈
	- **AWS Key Management Service(AWS KMS)**
	- **AWS 공개 키 인프라(PKI)** : 데이터 접근 및 보관을 보장
	- **AWS Encryption SDK** : 프로그래밍 언어에 다양한 암호화 라이브러리 제공
- 저장 및 신뢰성
![[Pasted image 20250321175519.png]]

- 사용한 만큼 지불 + 높은 가용성과 짧은 리전시간 + 새로 볼륨 할당해도 지연 거의 없음

## RDS와 Aurora 비교
### RDS 소개
- 완전관리형 관계형 DB 서비스
- 여러 일반 DB 엔진을 지원해 자동화 도구 및 기능 제공. 

### Aurora 이점
- 예약된 백업 수행동안 중단이나 느린 액세스 피할 수 있음. S3에 저장되어 DB 성능에 영향
- MySQL, PostgreSQL과 호환 및 기존 서비스보다 처리량 높음
- 10GB 단위로 확장되는 스토리지
- 몇 밀리초 만에 복제하고 15개까지 복제할 수 있음

### 글로벌 데이터베이스
![[Pasted image 20250321192248.png]]

- 장애에 대응하는 재해 복구 솔루션 지원: RPO(짧은 복구 시점 목표)와 RTO(짧은 복구 시간 목표)로 처리하고 클러스터에 미치는 영향은 최소화할 수 있는 재해 복구 솔루션 지원
- 리전에 밀접한 사용자를 위해 주변 리전 최대 5개의 클러스터에 읽기 전용 복제 제공
- 고려사항 및 제한사항
	- 보조 글로벌 클러스터는 반드시 주 클러스터와 다른 지역에 있어야함
	- 글로벌 DB 업그레이드시 보조 클러스터 먼저 업그레이드 -> 주 클러스터 업그레이드
	- 글로벌 데이터베이스의 제1 DB 클러스터가 RDS PostgreSQL 인스턴스 복제 기반하고 있으면 보조 클러스터를 생성할 수 없음
- 관리
	- CLI, API로 관리
	- 기능: 글로벌 DB 구성, 관찰하기, 지역간 재해 복구, 성능 개선 도우미로 권장사항 파악, 쓰기 전달, 클러스터 제거, 글로벌 데이터베이스 삭제 

### 서버리스 v1
- Aurora의 온디맨드 자동 크기 조정 구성
- 데이터베이스 클러스터를 자동으로 시작하고 중단하는 데 사용할 수 있으며 컴퓨팅 용량이 애플리케이션의 요구 사항에 맞춰 자동으로 확장
- 장점: 간편성, 확장성, 비용 효율성, 고가용성
- 제한: DB 클러스터는 VPC를 통해서만 액세스 가능 등
- 고객의 하드웨어 리소스 엔드포인트 연결을 프록시 플릿. 최소 최대 용량을 지정해놓으면 클러스터와 서버리스v1이 자동으로 매끄럽게 범위 안에서 필요한 리소스 크기를 조정함.

## MySQL 소개

### RDS 아키텍처
1. 애플리케이션 레이어
	- 외부 클라이언트 서비스 및 응용 프로그램 연결 제공
	- Proxy 기능 제공
	- VPC 내에서 생성함
2. 컴퓨팅 레이어
	- 데이터베이스 엔진과 컴퓨팅 리소스
	- 보안 관리, 클러스터링 및 복제 구성, 파티셔닝이 포함
	- 사용자는 DB 인스턴스가 사용하는 특정 저장 엔진을 관리하고 / 저장 레이어에서 데이터가 실제로 저장되는 위치를 관리
3. 저장 레이어
	- 데이터베이스 엔진에 데이터 저장소를 제공하는 하위 시스템
	- 장애 발생 디스크 볼륨의 자동 복구를 처리하고 장애가 발생한 볼륨을 다시 생성

| 특성         | Aurora MySQL                      | 자체 관리형 MySQL                  |
| ---------- | --------------------------------- | ----------------------------- |
| 관리         | 완전관리형 솔루션으로 많은 구성 요소를 자동 관리       | 사용자가 직접 모든 구성 요소를 관리          |
| 스토리지       | 자동 관리 및 권한 설정, 6개 가용 영역에 걸쳐 6번 복제 | 사용자가 직접 관리 및 설정               |
| 클러스터링 및 복제 | 전체 클러스터에 대한 자동 관리, 콘솔을 통한 통합 관리   | 개별 인스턴스 단위로 수동 설정 및 관리 필요     |
| 파라미터 그룹    | DB 파라미터 그룹을 통해 클러스터 전체 구성 관리      | 개별 인스턴스별로 파라미터 설정 필요          |
| 관리 파라미터    | 일부 파라미터는 시스템에서 자동 관리              | 모든 파라미터를 사용자가 직접 관리           |
| 스토리지 엔진    | InnoDB 권장, 자체 충돌 방지 저장 아키텍처 제공    | 다양한 스토리지 엔진 선택 가능, 사용자가 직접 구성 |
| 읽기 성능      | 향상된 프리페치 및 비동기 I/O 활용             | 기본 MySQL 성능에 의존               |
| 쓰기 안정성     | 향상된 이중 쓰기 버퍼 기술 활용                | 기본 MySQL 기능에 의존               |
| 가용성        | 여러 가용 영역에 걸친 자동 복제로 고가용성 보장       | 사용자가 직접 복제 및 가용성 구성 필요        |
| 비용 효율성     | 자동화된 관리로 운영 비용 절감                 | 직접 관리로 인한 추가 운영 비용 발생 가능      |

### Aurora DB 구성
- vpc 내에 존재하므로 외부에 연결하려면 특정 사항 준비
	- 베스천 or 프록시 서버 구축
	- 보안 그룹 설정
	- 퍼블릭 액세스로 설정
	- vpc 엔드포인트로 접근
	- 인터넷 게이트웨이 및 라우팅 테이블 설정
- IAM 설정
	- 기본 루트 사용자 계정 (데이터베이스 생성시에만 사용)
- 파라미터 그룹
	- DB 파라미터 그룹은 Amazon RDS와 Aurora DB 인스턴스를 관리
	- DB 클러스터 파라미터 그룹은 Aurora DB 클러스터만을 관리
- 내부 구성 환경 설정
	1. IAM 사용자 액세스 설정
	2. 프로젝트 요구사항 결정 
		- 보안 그룹을 구성하고 적절한 DB 인스턴스 클래스를 선택할 수 있도록
		- 메모리 / 프로세서 / 장애 조치 (multi AZ) / 위치 (서비스 대상 고객과 가까워야 지연시간이 줄어듦)
	3. VPC 구성
		- 2개의 서로 다른 가용영역에 있는 2개 이상의 서브넷
		- 인스턴스에 공개 접근 (DNS 등)
		- 엔드포인트 구성 (퍼블릭 액세스를 위해 공개)
		- DB 서브넷 그룹
		- 보안 그룹
		- CIDR 블록 : 충분히 수용 가능할 정도로 커야함
		- VPC 인스턴스 테넌시 : VPC가 어떤 인스턴스 클래스를 지원할지 여부
	4. DB 파라미터 그룹 + DB 클러스터 파라미터 그룹 설정
	5. DB 클러스터 생성
		- 엔진 옵션: 컴퓨팅 용량 유형 선택 / 단일 마스터 or 다중 마스터 배포 / mysql 버전 호환성
		- 템플릿
		- 설정: 클러스터 식별자, 마스터 사용자 정의 등
		- DB 인스턴스 크기/용량 설정
	6. 가용성 및 지속성 : Multi-AZ 배포 결정
	7. 연결 : vpc 환경 지정, SQL HTTP 엔드포인트 생성, RDS 콘솔에서 데이터베이스 쿼리
- Aurora DB에 AWS 서비스 액세스 권한 부여
	- IAM 역할을 DB 인스턴스에 생성
	1. AWS 서비스의 권한 부여하는 IAM 정책 생성
	2. IAM 역할 생성하고 역할에 정책 연결
	3. IAM 역할을 Aurora DB 클러스터와 연결
- 보안 
	- 사용자 인증은 IAM, MySQL 자체 사용자 권한 관리
	- VPC 보안 그룹
	- SSL/TLS 지원

### 데이터 사전
- 데이터 사전은 데이터베이스 내의 실제 업무 데이터가 저장된 테이블(트랜잭션 테이블)과 그 테이블의 구조(열과 행)에 대한 상세한 정보를 제공한다. 이 정보에는 테이블의 이름, 각 열의 데이터 타입, 제약 조건 등이 포함됩니다. 이를 통해 데이터베이스 관리자나 개발자는 데이터베이스의 구조를 쉽게 이해하고 관리할 수 있다.
- 목적 : 관리자와 개발자, DBMS 유틸리티 및 시스템 엔진이 DB 정보 및 특성에 액세스
- 사용법 : Workbench와 같은 유틸리티로 데이터베이스 내부 구조에 대한 정보 표시

- 데이터 사전을 사용하는 데이터베이스 인스턴스의 단점 중 하나는 데이터 정의 언어 작업이 더 오래 걸린다는 점. 그러나 데이터 사전은 일반 거래 테이블과 마찬가지로 롤백과 커밋으로 보호된다

## MySQL 저장 처리 및 백업 / 복구
- 기본 저장 엔진은 InnoDB. mysql 데이터베이스에는 9가지 저장 엔진이 있으나 aurora는 InnoDB 엔진만 지원
- 다른 엔진 MyISAM. 전체 텍스트 검색, 인덱싱, 인덱스 캐시, 특정 시점으로 복구 지원, 공간 데이터 지원, 테이블 수준 잠금 등을 지원 <-> ACID 모델을 준수하지 않으며 충돌 예방이 되지 않음
- ACID
	- **원자성** – 모든 운영은 전체가 성공적으로 완료되어야 합니다. 운영 중 일부라도 실패한다면 데이터는 스토리지에 커밋되지 않습니다
	- **일관성** **및** **격리성** – 모든 운영은 동시 진행 중인 다른 운영에 영향이 없어야 합니다. 읽기를 수행하는 중에 읽기에 관련된 여러 테이블에 데이터가 쓰여지고 있다면 읽기 운영은 기존 데이터나 신규 데이터만 볼 수 있고 두 데이터를 섞어서 볼 수 없습니다. 운영이 완전히 저장 될 때까지 다른 운영은 저장이 되지 않은 데이터의 영향을 볼 수 없습니다.
	- **내구성** – 거래의 결과로 데이터베이스에 만들어진 변경은 견고해야 하며 전원 장애의 경우에도 손실로부터 안전해야 합니다. 또, 쓰기 운영 중 일부가 성공적으로 완료되지 않았다면 운영 전체를 롤백할 수 있습니다.

### 데이터 보증
- 가용 영역 간에 공유되는 클러스터 볼륨에 데이터 복사본 6개 생성
- 자동 장애 감지와 조치 <-> 사내 MySQL 이용시 복잡한 복제 구성, 장애 조치와 복구 메커니즘 설정.
- 내결함성: 장애가 생기거나 중단이 발생해도 데이터 손실 없고 서비스에도 지장이 없도록 하는 것
	- 오로라 복제본의 장애 조치 우선 순위에 따라 자동으로 복제본을 새 주 인스턴스로 승격. 혹은 자동으로 새 주 인스턴스를 생성하고 클러스터 볼륨에 연결
	- 장애 조치 우선 순위: 어떤 복제본이 자동으로 주 인스턴스로 승격될지 정함
- 백업 및 스냅샷: 35일까지 보존. 그이상은 수동 스냅샷 생성 필요
	- 백업에서 복원: 복원의 가장 빠른 시점/늦은 시점 값을 제공. 특정 시점으로 복구할 수 있고 역추적(72시간 내 되돌리기 기능)
- mySQLdump 유틸리티
	- 기존 mysql db 백업 생성 후 rds mysql 인스턴스에 직접 백업 연결

### 백업 전략
- 장애 조치 시간 : 60초 이내로 실행 최대 120초 소요
	- 복제본을 주 인스턴스 대신으로 승격해서 더욱 줄일 . 수있음
- Backup 운영 지원: EFS, DynamoDB, EC2, EBS, Aurora, Volume gateway
	- 중앙 집중식 백업 솔루션
	- 교차 리전 백업
	- 교차 계정 관리
	- 정책 기반 백업 솔루션
	- 태그 기반 백업 정책
	- 백업 활동 모니터링
	- 수명 주기 관리정책
	- 백업 액세스 정책
- 모니터링
	- CloudWatch
	- CloudTrail

## 복제
Aurora MySQL의 AWS 리전 간 복제 방식을 비교한 표

| 복제 방식                     | 복제 유형       | 주요 사용 사례          | 주요 특징                                                        | 지원 리전      | 복제 대상              | RPO/RTO           | 제한 사항                      |
| ------------------------- | ----------- | ----------------- | ------------------------------------------------------------ | ---------- | ------------------ | ----------------- | -------------------------- |
| **Aurora 글로벌 데이터베이스**     | 물리적 스토리지 복제 | 글로벌 읽기/재해 복구      | - 전용 스토리지 계층 복제  <br>- 1초 RPO, 1분 미만 RTO<br>- 최대 5개 보조 리전 지원 | AWS 글로벌 리전 | Aurora 클러스터 간      | RPO 1초, RTO 1분 미만 | PostgreSQL은 보조 클러스터 1개만 지원 |
| **바이너리 로그 복제(교차 리전)**     | 논리적 복제      | 리전 확장/읽기 부하 분산    | - MySQL binlog 기반  <br>- 최대 5개 읽기 전용 복제본                     | 모든 AWS 리전  | Aurora ↔ Aurora    | 사용자 설정에 의존        | 복제 지연 발생 가능                |
| **동일 리전 내 복제**            | 물리적 복제      | 고가용성 구성           | - 동일 리전 내 15개 복제본 지원  <br>- 자동 장애 조치                         | 단일 AWS 리전  | Aurora 복제본 간       | 즉시 장애 조치          | 리전 단일화                     |
| **RDS MySQL → Aurora 복제** | 논리적 복제      | 마이그레이션/하이브리드 아키텍처 | - 지속적 복제 가능  <br>- DMS 활용 시 유연한 데이터 변환                       | 모든 AWS 리전  | RDS MySQL ↔ Aurora | 복제 지연 시간 의존       | 소스 DB 성능 영향 가능             |
| **자체 관리형 MySQL ↔ Aurora** | 논리적 복제      | 하이브리드 재해 복구       | - 온프레미스/Aurora 간 복제  <br>- CDC(변경 데이터 캡처) 방식                 | 크로스 클라우드   | 자체 관리 DB ↔ Aurora  | 네트워크 지연 영향        | 복잡한 설정 필요                  |

