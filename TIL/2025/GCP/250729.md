### Building a Data Lake

> 데이터 레이크 빌드하기

1. 데이터 레이크가 무엇인지
    - 다양한 규모의 다양한 유형의 데이터를 처리하고 분석하기 위해 안전하게 저장할 수 있는 장소
    - 모든 유형의 데이터 수용. 온프렘 클라우드 이동 가능
    - 데이터 소스 (원천)으로부터 출발
    - 데이터 싱크 - 모든 데이터 수용 가능해야함. → 이후에 데이터 웨어하우스 이동 (변환)
    - 데이터레이크와 데이터웨어하우스 차이는 원시 데이터 저장 (무엇이든 객체로 저장) / 분석 데이터 저장 (열기반 저장)
2. 데이터 스토리지와 ETL 
    - 어디서 오는지, 볼륨이 어느정도인지, 어디로 가는지, 얼마나 많은 변환이 필요한지
    - Avro 파일을 바로 적재 (스키마가 동일한 경우) = EL
    - 로드 된 형식이 원하는 형식이 아니라 데이터를 수정해야 하는 경우 = ELT
    - 대량의 데이터 변환이 필요할 때, 여러 처리가 선행 된 후 적재하고 싶을 때 = ETL
3. Cloud Storage 데이터 레이크 구축하기
    - 영구적, 저렴, 전역적 공유 및 비공개 제어, 글로벌 가용성, 단일 지리적 위치 보관도 가능, 적당한 지연 시간과 높은 처리량 등의 특징을 가짐
    - 버킷 이름 변경 불가, 여러 리전에 연결되며 복제됨. 리전 내 데이터 전송시 네트워크 이그레스 비용이 절약됨. 손상되는 경우 새 복제본으로 교체됨.
    - 메타데이터도 함께 저장됨. 파일 디렉터리와 다르게 객체 위치는 전체가 통으로 key로 동작함
    - Standard > Nearline > Coldline > Archive
4. 보안
    - IAM 정책과 액세스 제어 목록을 동시에 이용할 수 있음

| 상황                              | 동작 방식                                  |
| ------------------------------- | -------------------------------------- |
| **객체에 대한 액세스 요청 발생 시**          | GCS는 **IAM과 ACL 중 하나라도 권한을 부여하면 허용됨**  |
| **두 정책 중 하나라도 허용이면 → 허용**       | 허용됨                                 |
| **두 정책 모두에서 명시적으로 거부는 없음**      | IAM/ACL에는 "명시적 거부"가 없음 → 허용이 없으면 거부됨 |
| **IAM은 프로젝트/버킷 수준에 주로 적용**      | 상위 리소스 기반 권한                           |
| **ACL은 개별 객체 수준에서 예외적으로 적용 가능** | 세밀 제어 목적                               |

- 다양한 데이터 보호 방법
    - GMEK 데이터 암호화 키 자동으로 주기에 따라 변경됨. 
    - CMEK 고객 관리 키
    - CSEK 고객 제공 암호화 키 
    - 클라이언트 측 암호화 (데이터 업로드 전 암호화 - 사용시에 복호화 필요)
    - 객체 잠금 (로그, 객체 변경/삭제 불가) / 잠금 보존 정책 등
5. 모든 종류의 데이터 유형을 저장
    - 트랜잭션 워크로드는 Cloud SQL 혹은 Firestore(NoSQL) 사용 
    - 거래 워크로드와 분석 워크로드 구분
        - 거래 워크로드는 많이 쓰고 적게 읽음. 트랜잭션 워크로드 (Cloud SQL, spaner)
        - 분석 워크로드는 적게 쓰고 많이 읽음 (Bigquery, Bigtable)
6. OLTP 워크로드에 대한 기본 선택사항 : Cloud SQL
    - Cloud SQL RDB 관리형 서비스 
    - 가용성 보장. 외부 서비스에서 엑세스 가능하도록 제공.
    - 수직적 확장 가능, 수평적으로는 읽기 복제본 사용
    - 장애 복지 복사본은 비용 발생함. 장애 발생시 동일한 IP로 접근 가능하기 때문에 애플리케이션 수정 필요 없음
